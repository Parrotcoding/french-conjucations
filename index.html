<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ÃŠtre Speedrun</title>

<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  background:#070b14;
  color:#eef2ff;
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
}

.screen{
  display:none;
  height:100%;
  width:100%;
  box-sizing:border-box;
  padding:32px;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  text-align:center;
}

.screen.active{display:flex}

h1{margin:0 0 8px}
p{color:#a9b4d0;margin:6px 0 18px}

button{
  padding:14px 26px;
  border-radius:999px;
  border:none;
  background:#60a5fa;
  color:#000;
  font-weight:800;
  cursor:pointer;
}

button.secondary{
  background:rgba(255,255,255,.12);
  color:#eef2ff;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  width:100%;
  max-width:640px;
}

.tile{
  padding:16px;
  border-radius:16px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  font-size:18px;
  font-weight:800;
  cursor:pointer;
}

.tile.selected{outline:3px solid #60a5fa}
.tile.correct{
  background:rgba(52,211,153,.25);
  border-color:#34d399;
  cursor:default;
}

input{
  padding:14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.08);
  color:#eef2ff;
  font-size:18px;
  width:280px;
  text-align:center;
}

.status{margin-top:16px;font-weight:800}
.good{color:#34d399}
.bad{color:#fb7185}

.timer{
  position:fixed;
  top:16px;
  right:16px;
  background:rgba(0,0,0,.4);
  padding:8px 14px;
  border-radius:999px;
  font-weight:800;
}
</style>
</head>

<body>

<div class="timer" id="timer">0.00</div>

<!-- START -->
<div class="screen active" id="start">
  <h1>ÃŠtre Speedrun</h1>
  <p>Match â†’ Scenarios â†’ Leaderboard</p>
  <button onclick="startGame()">Start</button>
</div>

<!-- MATCHING -->
<div class="screen" id="match">
  <h1>Match the phrases</h1>
  <div class="grid" id="matchGrid"></div>
</div>

<!-- SCENARIOS -->
<div class="screen" id="scenarios">
  <h1 id="prompt"></h1>

  <input id="answer" placeholder="Type answerâ€¦" autocomplete="off">
  <div style="margin-top:12px">
    <button onclick="insertAccent()">1 = Ãª</button>
  </div>

  <div class="status" id="status"></div>
</div>

<!-- FINISH -->
<div class="screen" id="finish">
  <h1>Finished ðŸŽ‰</h1>
  <p id="finalTime"></p>
</div>

<script>
const API_URL = "https://pronounfrenchleaderboard.orcajoon.workers.dev/api/highscores";

const pairs = [
  "Je suis","Tu es","Il est","Elle est",
  "On est","Nous sommes","Vous Ãªtes",
  "Ils sont","Elles sont"
];

let startTime, timerInt;
const timerEl = document.getElementById("timer");

function startTimer(){
  startTime = performance.now();
  timerInt = setInterval(()=>{
    timerEl.textContent = ((performance.now()-startTime)/1000).toFixed(2);
  },50);
}

function stopTimer(){
  clearInterval(timerInt);
}

function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function shuffle(a){
  return [...a].sort(()=>Math.random()-0.5);
}

/* MATCHING */
let first=null, matched=0;
function startGame(){
  startTimer();
  show("match");
  const grid=document.getElementById("matchGrid");
  grid.innerHTML="";
  shuffle(pairs).forEach(text=>{
    const d=document.createElement("div");
    d.className="tile";
    d.textContent=text;
    d.onclick=()=>{
      if(d.classList.contains("correct"))return;
      d.classList.add("selected");
      if(!first){first=d}
      else{
        if(first.textContent===d.textContent){
          first.classList.add("correct");
          d.classList.add("correct");
          matched++;
          if(matched===pairs.length){
            setTimeout(startScenarios,400);
          }
        }else{
          first.classList.remove("selected");
          d.classList.remove("selected");
        }
        first=null;
      }
    };
    grid.appendChild(d);
  });
}

/* SCENARIOS */
const scenarios = shuffle([
  ["Pierre is","Il est"],
  ["Marie is","Elle est"],
  ["They (mixed) are","Ils sont"],
  ["They (mixed) are","Ils sont"],
  ["They (female) are","Elles sont"],
  ["We are","Nous sommes"],
  ["You are (informal)","Tu es"],
  ["You are (formal)","Vous Ãªtes"],
  ["I am","Je suis"],
  ["One is / people are","On est"]
]);

let q=0;
function startScenarios(){
  show("scenarios");
  nextQ();
}

function nextQ(){
  if(q>=scenarios.length){
    stopTimer();
    show("finish");
    document.getElementById("finalTime").textContent =
      "Time: "+timerEl.textContent+"s";
    return;
  }
  document.getElementById("prompt").textContent=scenarios[q][0];
  document.getElementById("answer").value="";
  document.getElementById("status").textContent="";
}

document.getElementById("answer").addEventListener("keydown",e=>{
  if(e.key==="Enter")check();
  if(e.key==="1"){e.preventDefault();insertAccent();}
});

function insertAccent(){
  const i=document.getElementById("answer");
  i.value+="Ãª";
}

function norm(s){return s.trim().toLowerCase().replace(/\s+/g," ")}

function check(){
  const ok = norm(answer.value)===norm(scenarios[q][1]);
  const st=document.getElementById("status");
  if(ok){
    st.textContent="Correct âœ“";
    st.className="status good";
    q++;
    setTimeout(nextQ,300);
  }else{
    st.textContent="Try again";
    st.className="status bad";
  }
}
</script>

</body>
</html>
